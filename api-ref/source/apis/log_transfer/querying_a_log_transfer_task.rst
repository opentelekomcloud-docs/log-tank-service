:original_name: ListTransfers.html

.. _ListTransfers:

Querying a Log Transfer Task
============================

Function
--------

This API is used to query OBS transfer tasks.

URI
---

GET /v2/{project_id}/transfers

.. table:: **Table 1** Path Parameters

   +-----------------+-----------------+-----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                |
   +=================+=================+=================+============================================================================================================================================================+
   | project_id      | Yes             | String          | Project ID. For details about how to obtain a project ID, see :ref:`Obtaining the Project ID, Account ID, Log Group ID, and Log Stream ID <lts_api_0006>`. |
   |                 |                 |                 |                                                                                                                                                            |
   |                 |                 |                 | Minimum: **32**                                                                                                                                            |
   |                 |                 |                 |                                                                                                                                                            |
   |                 |                 |                 | Maximum: **32**                                                                                                                                            |
   +-----------------+-----------------+-----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 2** Query Parameters

   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter         | Mandatory       | Type            | Description                                                                                                                         |
   +===================+=================+=================+=====================================================================================================================================+
   | log_transfer_type | No              | String          | Log transfer type. **OBS** indicates that logs are transferred to OBS.                                                              |
   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+
   | log_group_name    | No              | String          | Log group name.                                                                                                                     |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Minimum: **1**                                                                                                                      |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Maximum: **64**                                                                                                                     |
   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+
   | log_stream_name   | No              | String          | Log stream name.                                                                                                                    |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Minimum: **1**                                                                                                                      |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Maximum: **64**                                                                                                                     |
   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+
   | offset            | No              | Integer         | Query cursor. Set the value to 0 in the first query. In subsequent queries, obtain the value from the response to the last request. |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Minimum: **0**                                                                                                                      |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Maximum: **1024**                                                                                                                   |
   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+
   | limit             | No              | Integer         | Number of records on each page. The maximum value is 100.                                                                           |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Minimum: **0**                                                                                                                      |
   |                   |                 |                 |                                                                                                                                     |
   |                   |                 |                 | Maximum: **100**                                                                                                                    |
   +-------------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 3** Request header parameters

   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                   |
   +=================+=================+=================+===============================================================================================================================+
   | X-Auth-Token    | Yes             | String          | User token obtained from IAM. For details about how to obtain a user token, see :ref:`Obtaining a User Token <lts_api_0004>`. |
   |                 |                 |                 |                                                                                                                               |
   |                 |                 |                 | Minimum: **1000**                                                                                                             |
   |                 |                 |                 |                                                                                                                               |
   |                 |                 |                 | Maximum: **2000**                                                                                                             |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------+
   | Content-Type    | Yes             | String          | Set this parameter to application/json;charset=UTF-8.                                                                         |
   |                 |                 |                 |                                                                                                                               |
   |                 |                 |                 | Minimum: **30**                                                                                                               |
   |                 |                 |                 |                                                                                                                               |
   |                 |                 |                 | Maximum: **30**                                                                                                               |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 4** Response body parameters

   +---------------+---------------------------------------------------------------------------------------------------------+--------------------------------+
   | Parameter     | Type                                                                                                    | Description                    |
   +===============+=========================================================================================================+================================+
   | log_transfers | Array of :ref:`CreateTransferResponseBody <listtransfers__response_createtransferresponsebody>` objects | Log transfer task information. |
   +---------------+---------------------------------------------------------------------------------------------------------+--------------------------------+

.. _listtransfers__response_createtransferresponsebody:

.. table:: **Table 5** CreateTransferResponseBody

   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+
   | Parameter         | Type                                                                                          | Description               |
   +===================+===============================================================================================+===========================+
   | log_group_id      | String                                                                                        | Log group ID.             |
   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+
   | log_group_name    | String                                                                                        | Log group name.           |
   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+
   | log_streams       | Array of :ref:`log_streams <listtransfers__response_log_streams>` objects                     | Log stream list.          |
   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+
   | log_transfer_id   | String                                                                                        | Log transfer task ID.     |
   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+
   | log_transfer_info | :ref:`log_transfer_info_RespBody <listtransfers__response_log_transfer_info_respbody>` object | Log transfer information. |
   +-------------------+-----------------------------------------------------------------------------------------------+---------------------------+

.. _listtransfers__response_log_streams:

.. table:: **Table 6** log_streams

   =============== ====== ================
   Parameter       Type   Description
   =============== ====== ================
   log_stream_id   String Log stream ID.
   log_stream_name String Log stream name.
   =============== ====== ================

.. _listtransfers__response_log_transfer_info_respbody:

.. table:: **Table 7** log_transfer_info_RespBody

   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter           | Type                                                                            | Description                                                                                                                                                                                              |
   +=====================+=================================================================================+==========================================================================================================================================================================================================+
   | log_agency_transfer | :ref:`log_agency_transfer <listtransfers__response_log_agency_transfer>` object | Information about delegated log transfer. This parameter is returned for a delegated log transfer task.                                                                                                  |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_create_time     | Integer                                                                         | Time when the log transfer task was created.                                                                                                                                                             |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_storage_format  | String                                                                          | Log transfer format. The value can be **RAW** or **JSON**. **RAW** indicates the raw log format, and **JSON** indicates the JSON format. Both **JSON** and **RAW** are available for OBS transfer tasks. |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_transfer_detail | :ref:`TransferDetail <listtransfers__response_transferdetail>` object           | Log transfer details.                                                                                                                                                                                    |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_transfer_mode   | String                                                                          | Log transfer mode. **cycle** indicates periodical transfer, and **realTime** indicates real-time transfer. Only **cycle** is available for OBS transfer tasks.                                           |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_transfer_status | String                                                                          | Log transfer status. **ENABLE** indicates that log transfer is enabled, **DISABLE** indicates that log transfer is disabled, and **EXCEPTION** indicates that log transfer is abnormal.                  |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_transfer_type   | String                                                                          | Log transfer type. **OBS** indicates that logs are transferred to OBS.                                                                                                                                   |
   +---------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _listtransfers__response_log_agency_transfer:

.. table:: **Table 8** log_agency_transfer

   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | Parameter            | Type   | Description                                                                                       |
   +======================+========+===================================================================================================+
   | agency_domain_id     | String | Delegator account ID.                                                                             |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | agency_domain_name   | String | Delegator account name.                                                                           |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | agency_name          | String | Name of the agency created by the delegator.                                                      |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | agency_project_id    | String | Project ID of the delegator.                                                                      |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | be_agency_domain_id  | String | Account ID of the delegated party (ID of the account that created the log transfer task).         |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+
   | be_agency_project_id | String | Project ID of the delegated party (project ID of the account that created the log transfer task). |
   +----------------------+--------+---------------------------------------------------------------------------------------------------+

.. _listtransfers__response_transferdetail:

.. table:: **Table 9** TransferDetail

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                                                                                                                                                                                                                                          |
   +=======================+=======================+======================================================================================================================================================================================================================================================================================================================================================+
   | obs_period            | Integer               | Length of the transfer interval for an OBS transfer task. This parameter is required when you create an OBS transfer task. The log transfer interval is specified by the combination of the values of **obs_period** and **obs_period_unit**, and must be set to one of the following: 2 min, 5 min, 30 min, 1 hour, 3 hours, 6 hours, and 12 hours. |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_period_unit       | String                | Unit of the transfer interval for an OBS transfer task. This parameter is required when you create an OBS transfer task. The log transfer interval is specified by the combination of the values of **obs_period** and **obs_period_unit**, and must be set to one of the following: 2 min, 5 min, 30 min, 1 hour, 3 hours, 6 hours, and 12 hours.   |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_bucket_name       | String                | OBS bucket name. This parameter is required when you create an OBS transfer task.                                                                                                                                                                                                                                                                    |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_encrypted_id      | String                | KMS key ID for an OBS transfer task. This parameter is required if encryption is enabled for the target OBS bucket.                                                                                                                                                                                                                                  |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_dir_pre_fix_name  | String                | Custom transfer path of an OBS transfer task. This parameter is optional.                                                                                                                                                                                                                                                                            |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | The value must match the regular expression:                                                                                                                                                                                                                                                                                                         |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | ^(/)?([a-zA-Z0-9._-]+)(/[a-zA-Z0-9._-]+)*(/)?$                                                                                                                                                                                                                                                                                                       |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_prefix_name       | String                | Transfer file prefix of an OBS transfer task. This parameter is optional.                                                                                                                                                                                                                                                                            |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | The value must match the regular expression:                                                                                                                                                                                                                                                                                                         |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | ^[a-zA-Z0-9._-]*$                                                                                                                                                                                                                                                                                                                                    |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_time_zone         | String                | Time zone for an OBS transfer task. If this parameter is specified, **obs_time_zone_id** must also be specified.                                                                                                                                                                                                                                     |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_time_zone_id      | String                | ID of the time zone for an OBS transfer task. For details, see Time Zone List for OBS Transfer. If this parameter is specified, **obs_time_zone** must also be specified.                                                                                                                                                                            |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_transfer_path     | String                | OBS bucket path, which is the log transfer destination.                                                                                                                                                                                                                                                                                              |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_eps_id            | String                | Enterprise project ID of an OBS transfer task.                                                                                                                                                                                                                                                                                                       |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | obs_encrypted_enable  | Boolean               | Whether OBS bucket encryption is enabled.                                                                                                                                                                                                                                                                                                            |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tags                  | Array of strings      | If tag delivery is enabled, this field must contain the following host information: **hostIP**, **hostId**, **hostName**, **pathFile**, and **collectTime**.                                                                                                                                                                                         |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | The common fields include **logStreamName**, **regionName**, **logGroupName** and **projectId**, which are optional.                                                                                                                                                                                                                                 |
   |                       |                       |                                                                                                                                                                                                                                                                                                                                                      |
   |                       |                       | The transfer tag **streamTag** is optional.                                                                                                                                                                                                                                                                                                          |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 10** Response body parameters

   ========== ====== ==============
   Parameter  Type   Description
   ========== ====== ==============
   error_code String Error code.
   error_msg  String Error message.
   ========== ====== ==============

**Status code: 500**

.. table:: **Table 11** Response body parameters

   ========== ====== ==============
   Parameter  Type   Description
   ========== ====== ==============
   error_code String Error code.
   error_msg  String Error message.
   ========== ====== ==============

Example Requests
----------------

If no parameter is specified, all log transfer tasks are returned. If log_transfer_type, log_group_name, and log_stream_name are specified, the corresponding log transfer task is returned.

.. code-block:: text

   GET https://{endpoint}/v2/{project_id}/transfers

   /v2/{project_id}/transfers /v2/{project_id}/transfers?log_group_name=lts-group-txxx /v2/{project_id}/transfers?log_transfer_type=OBS /v2/{project_id}/transfers?log_stream_name=lts-topic-testRexxx /v2/{project_id}/transfers?log_group_name=lts-group-txxx&log_transfer_type=OBS /v2/{project_id}/transfers?log_group_name=lts-group-txxx&log_stream_name=lts-topic-testRxxx /v2/{project_id}/transfers?log_transfer_type=OBS&log_stream_name=lts-topic-testRxxx /v2/{project_id}/transfers?log_group_name=lts-group-txxx&log_transfer_type=OBS&log_stream_name=lts-topic-testRexxx

Example Responses
-----------------

**Status code: 200**

The query is successful.

The following parameters are returned for an OBS transfer task:

.. code-block::

   {
     "log_transfers" : [ {
       "log_group_id" : "9a7e2183-2d6d-4732-9a9b-e897fd4e49e0",
       "log_group_name" : "lts-group-OBS",
       "log_streams" : [ {
         "log_stream_id" : "839dac89-35af-4db2-ab4a-a7dda0d0d3f8",
         "log_stream_name" : "lts-topic-OBS"
       } ],
       "log_transfer_id" : "ddced522-233a-4181-a5fc-7b458c819afc",
       "log_transfer_info" : {
         "log_create_time" : 1634802241847,
         "log_storage_format" : "JSON",
         "log_agency_transfer" : {
           "agency_domain_id" : "1d26cc8c86a840e28a4f8d0d078xxxxx",
           "agency_domain_name" : "paas_apm_z004xxxxx_xx",
           "agency_name" : "test20210325",
           "agency_project_id" : "2a473356cca5487f8373be891bfxxxxx",
           "be_agency_domain_id" : "1d26cc8c86a840e28a4f8d0d078xxxxx",
           "be_agency_project_id" : "2a473356cca5487f8373be891bfxxxxx"
         },
         "log_transfer_detail" : {
           "obs_period" : 2,
           "obs_prefix_name" : "",
           "obs_period_unit" : "min",
           "obs_transfer_path" : "/0002/LogTanks/xxx/",
           "obs_bucket_name" : "0002",
           "obs_encrypted_enable" : false,
           "obs_dir_pre_fix_name" : "",
           "obs_time_zone" : "UTC+01:00",
           "obs_time_zone_id" : "Africa/Lagos"
         },
         "log_transfer_mode" : "cycle",
         "log_transfer_status" : "ENABLE",
         "log_transfer_type" : "OBS"
       }
     } ]
   }

**Status code: 400**

Invalid request. Modify the request based on the description in **error_msg** before a retry.

.. code-block::

   {
     "error_code" : "LTS.0001",
     "error_msg" : "Invalid log transfer type"
   }

**Status code: 500**

The server has received the request but encountered an internal error.

.. code-block::

   {
     "error_code" : "LTS.0010",
     "error_msg" : "The system encountered an internal error"
   }

Status Codes
------------

+-------------+-----------------------------------------------------------------------------------------------+
| Status Code | Description                                                                                   |
+=============+===============================================================================================+
| 200         | The query is successful.                                                                      |
+-------------+-----------------------------------------------------------------------------------------------+
| 400         | Invalid request. Modify the request based on the description in **error_msg** before a retry. |
+-------------+-----------------------------------------------------------------------------------------------+
| 500         | The server has received the request but encountered an internal error.                        |
+-------------+-----------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
