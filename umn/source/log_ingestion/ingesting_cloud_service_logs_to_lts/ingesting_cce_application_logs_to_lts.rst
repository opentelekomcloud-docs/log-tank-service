:original_name: lts_04_0511.html

.. _lts_04_0511:

Ingesting CCE Application Logs to LTS
=====================================

CCE provides highly scalable, high-performance, enterprise-class Kubernetes clusters. With CCE, you can easily deploy, manage, and scale containerized applications.

After ingesting CCE logs to LTS, you can centrally manage and analyze them on the LTS console. This helps you promptly detect container issues and improve container performance and reliability.

Perform the following steps to complete the ingestion configuration:

#. :ref:`Step 1: Select a Log Stream <lts_04_0511__en-us_topic_0000001327056857_section937219613496>`
#. :ref:`Step 2: Check Dependencies <lts_04_0511__en-us_topic_0000001327056857_section153578366307>`
#. :ref:`Step 3: (Optional) Select a Host Group <lts_04_0511__en-us_topic_0000001327056857_section1394916683113>`
#. :ref:`Step 4: Configure the Collection <lts_04_0511__en-us_topic_0000001327056857_section1191613128141>`
#. :ref:`Step: Configure Log Structuring <lts_04_0511__en-us_topic_0000001327056857_section1378734643812>`
#. :ref:`Step 5: Configure Indexing <lts_04_0511__en-us_topic_0000001327056857_section164619915326>`
#. :ref:`Step 6: Complete the Ingestion Configuration <lts_04_0511__en-us_topic_0000001327056857_section2042505817322>`

To collect logs from multiple scenarios, :ref:`set multiple ingestion configurations in a batch <lts_04_0511__en-us_topic_0000001327056857_section124378505151>`.

Prerequisites
-------------

-  ICAgent has been installed in the CCE cluster and a host group with custom identifiers has been created for related nodes. The system will automatically check these configurations and make necessary corrections when CCE logs are ingested to LTS.

   On the **Hosts** page, click **CCE Clusters**, select the target cluster in the search box, and click **Upgrade ICAgent**. For details, see :ref:`Upgrading ICAgent <lts_02_0014__en-us_topic_0000001167072801_section3441614134517>`.

-  You have disabled **Output to AOM**.

Constraints
-----------

-  CCE cluster nodes whose container engine is Docker are supported. .

-  CCE cluster nodes whose container engine is containerd are supported. You must be using ICAgent 5.12.130 or later.

-  To collect container log directories mounted to host directories to LTS, you must configure the node file path.

-  Constraints on the Docker storage driver: Currently, container file log collection supports only the overlay2 storage driver. devicemapper cannot be used as the storage driver. Run the following command to check the storage driver type:

   .. code-block::

      docker info | grep "Storage Driver"

-  If you select **Fixed log stream** for log ingestion, ensure that you have created a CCE cluster.

.. _lts_04_0511__en-us_topic_0000001327056857_section937219613496:

Step 1: Select a Log Stream
---------------------------

#. Log in to the management console and choose **Management & Deployment** > **Log Tank Service**.

#. Choose **Log Ingestion** > **Ingestion Center** in the navigation pane and click **CCE (Cloud Container Engine)**.

   You can also choose **Log Ingestion** > **Ingestion Management** in the navigation pane and click **Ingest Log**. On the displayed page, choose **CCE (Cloud Container Engine)**.

#. Choose a collection mode between **Fixed log stream** and **Custom log stream**.

   -  If you set **Collect** to **Fixed log stream**, perform the following steps:

      Logs will be collected to a fixed log stream. The default log streams for a CCE cluster are **stdout-**\ *{ClusterID}* for standard output/errors, **hostfile-**\ *{ClusterID}* for node files, **event-**\ *{ClusterID}* for Kubernetes events, and **containerfile-**\ *{ClusterID}* for container files. Log streams are automatically named with a cluster ID. For example, if the cluster ID is **Cluster01**, the standard output/error log stream is **stdout-Cluster01**.

      Log streams that can be created for a CCE cluster are **stdout-**\ *{ClusterID}* for standard output/errors, **hostfile-**\ *{ClusterID}* for node files, **event-**\ *{ClusterID}* for Kubernetes events, and **containerfile-**\ *{ClusterID}* for container files. If one of them has been created in a log group, the log stream will no longer be created in the same log group or other log groups.

      a. Select a cluster from the **CCE Cluster** drop-down list.
      b. The default log group is **k8s-log-**\ *ClusterID*. For example, if the cluster ID is **c7f3f4a5-bcb8-11ed-a4ec-0255ac100b07**, the default log group will be **k8s-log-c7f3f4a5-bcb8-11ed-a4ec-0255ac100b07**. If there is no such group, the system displays the following message: This log group does not exist and will be automatically created to start collecting logs.
      c. Click **Next: Check Dependencies**.

   -  If you set **Collect** to **Custom log stream**, perform the following steps:

      a. Select a cluster from the **CCE Cluster** drop-down list.

      b. Select a log group from the **Log Group** drop-down list. If there are no desired log groups, click **Create Log Group** to create one.

      c. Select a log stream from the **Log Stream** drop-down list. If there are no desired log streams, click **Create Log Stream** to create one.

      d. Click **Next: Check Dependencies**.


         .. figure:: /_static/images/en-us_image_0000001992588517.png
            :alt: **Figure 1** Custom log stream

            **Figure 1** Custom log stream

.. _lts_04_0511__en-us_topic_0000001327056857_section153578366307:

Step 2: Check Dependencies
--------------------------

The system automatically checks the following items:

#. ICAgent has been installed (version 5.12.130 or later).
#. There is a host group with the custom identifier **k8s-log-**\ *ClusterID*.
#. There is a log group named **k8s-log-**\ *ClusterID*. If **Fixed log stream** is selected, this item is checked.
#. The recommended log stream exists. If **Fixed log stream** is selected, this item is checked.

You need to meet all the requirements before moving on. If not, click **Auto Correct**.

-  **Auto Correct**: Configure the previous dependencies with one click.
-  **Check Again**: Recheck dependencies.

.. _lts_04_0511__en-us_topic_0000001327056857_section1394916683113:

Step 3: (Optional) Select a Host Group
--------------------------------------

A host group is a virtual group of hosts, allowing you to configure host log collection efficiently. ICAgent has been installed in the CCE cluster and a host group with custom identifiers has been created for related nodes. The system will automatically check these configurations and make necessary corrections when CCE logs are ingested to LTS.

#. In the host group list, select one or more host groups to collect their logs.

   -  The host group to which the cluster belongs is selected by default. You can also select host groups as required.
   -  You can skip this step and configure host groups as follows after the ingestion configuration is complete. **However, you are advised to configure host groups during the first ingestion configuration to ensure that the configuration takes effect.**

      -  Choose **Host Management** > **Host Groups** in the navigation pane and associate host groups with ingestion configurations.
      -  Choose **Log Ingestion** > **Ingestion Management** in the navigation pane. In the ingestion configuration list, click **Modify** in the **Operation** column. On the page displayed, select required host groups.

#. If there are no desired host groups, click **Create** above the host group list.

   -  On the **Create Host Group** page displayed, select hosts with ICAgent installed under **Add Host**. For details, see :ref:`Managing Host Groups <lts_02_1033>`.
   -  If the desired host has no ICAgent installed, click **Install ICAgent** under **Add Host**. Select **Intra-region hosts** or **Extra-region hosts** based on the host location and install ICAgent by referring to :ref:`Installing ICAgent (Intra-Region Hosts) <lts_02_0013>`. After ICAgent is installed on the desired host, return to the ECS log ingestion page, click **Create** above the host group list again. The desired host will now be displayed under **Add Host** on the **Create Host Group** page.

#. Click **Next: Configurations**.

.. _lts_04_0511__en-us_topic_0000001327056857_section1191613128141:

Step 4: Configure the Collection
--------------------------------

When CCE is used to ingest logs, the configuration details are as follows:

#. **Collection Configuration Name**: Enter 1 to 64 characters. Only letters, digits, hyphens (-), underscores (_), and periods (.) are allowed. Do not start with a period or underscore, or end with a period.

#. **Data Source**: Select a data source type and configure it. For details, see :ref:`Table 1 <lts_04_0511__en-us_topic_0000001327056857_table17632135620560>`.

   .. _lts_04_0511__en-us_topic_0000001327056857_table17632135620560:

   .. table:: **Table 1** Data source parameters

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                  |
      +===================================+==============================================================================================================================================================================================================================================================================================================================================================================================================+
      | Container standard output         | Collects stderr and stdout logs of a specified container in the cluster.                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | The standard output of the matched container is collected to the specified log stream. Standard output to AOM stops.                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Output to AOM**: ICAgent has been installed on hosts in the cluster and collects container standard output to AOM only. This function is enabled by default. To collect container standard output to LTS, disable this function.                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  Either **Container Standard Output (stdout)** or **Container Standard Error (stderr)** must be enabled.                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  If you enable **Container Standard Error (stderr)**, select your collection destination path: **Collect standard output and standard error to different files (stdout.log and stderr.log)** or **Collect standard output and standard error to the same file (stdout.log)**.                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Allows multiple file collection** (not available to Windows)                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you enable this function, one host log file can be collected to multiple log streams.                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you disable this function, each collection path must be unique. That is, the same log file in the same host cannot be collected to different log streams.                                                                                                                                                                                                                                           |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container file                    | Collects file logs of a specified container in the cluster.                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Add Collection Path**: Add one or more host paths. LTS will collect logs from these paths. For more examples, see :ref:`Collection Paths <lts_04_1031__en-us_topic_0000001118501736_li17754123317308>`.                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    If a container mount path has been configured for the CCE cluster workload, the paths added for this field are invalid. The collection paths take effect only after the mount path is deleted.                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Add Custom Wrapping Rule**: ICAgent determines whether a file is wrapped based on the file name rule. If your wrapping rule does not comply with the built-in rules, you can add a custom wrap rule to prevent log loss during repeated collection and wrapping.                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    The built-in rules are *{basename}{connector}{wrapping identifier}.{suffix}* and *{basename}.{suffix}{connector}{wrapping identifier}*. Connectors can be hyphens (-), periods (.), or underscores (_), wrapping identifiers can contain only non-letter characters, and the suffix can contain only letters.                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    A custom wrapping rule consists of *{basename}* and the feature regular expression of the wrapped file. Example: If your log file name is **test.out.log** and the names after wrapping are **test.2024-01-01.0.out.log** and **test.2024-01-01.1.out.log**, configure the collection path to **/opt/*.log**, and add a custom wrapping rule: *{basename}*\ **\\.\\d{4}-\\d{2}-\\d{2}\\.\\d{1}.out.log**. |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Allows multiple file collection** (not available to Windows)                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you enable this function, one host log file can be collected to multiple log streams.                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you disable this function, each collection path must be unique. That is, the same log file in the same host cannot be collected to different log streams.                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Set Collection Filters**: Blacklisted directories or files will not be collected. If you specify a directory, all files in the directory are filtered out.                                                                                                                                                                                                                                              |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node file                         | Collects files of a specified node in a cluster.                                                                                                                                                                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Add Collection Path**: Add one or more host paths. LTS will collect logs from these paths. For more examples, see :ref:`Collection Paths <lts_04_1031__en-us_topic_0000001118501736_li17754123317308>`.                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Add Custom Wrapping Rule**: ICAgent determines whether a file is wrapped based on the file name rule. If your wrapping rule does not comply with the built-in rules, you can add a custom wrap rule to prevent log loss during repeated collection and wrapping.                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    The built-in rules are *{basename}{connector}{wrapping identifier}.{suffix}* and *{basename}.{suffix}{connector}{wrapping identifier}*. Connectors can be hyphens (-), periods (.), or underscores (_), wrapping identifiers can contain only non-letter characters, and the suffix can contain only letters.                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    A custom wrapping rule consists of *{basename}* and the feature regular expression of the wrapped file. Example: If your log file name is **test.out.log** and the names after wrapping are **test.2024-01-01.0.out.log** and **test.2024-01-01.1.out.log**, configure the collection path to **/opt/*.log**, and add a custom wrapping rule: *{basename}*\ **\\.\\d{4}-\\d{2}-\\d{2}\\.\\d{1}.out.log**. |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Allows multiple file collection** (not available to Windows)                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you enable this function, one host log file can be collected to multiple log streams.                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    After you disable this function, each collection path must be unique. That is, the same log file in the same host cannot be collected to different log streams.                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | -  **Set Collection Filters**: Blacklisted directories or files will not be collected. If you specify a directory, all files in the directory are filtered out.                                                                                                                                                                                                                                              |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Kubernetes event                  | Collects event logs of the Kubernetes cluster.                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   | Kubernetes events of a Kubernetes cluster can be collected to only one log stream.                                                                                                                                                                                                                                                                                                                           |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. (Optional) **Kubernetes Matching Rules**: Set these parameters only when the data source type is set to **Container standard output** or **Container file**.

   After entering a regular expression, click **Verify** to verify it.

   .. table:: **Table 2** Kubernetes matching rules

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
      +===================================+====================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
      | Namespace Name Regular Expression | Specifies the container whose logs are to be collected based on the namespace name. Regular expression matching is supported.                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS will collect logs of the namespaces with names matching this expression. To collect logs of all namespaces, leave this field empty.                                                                                                                                                                                                                                                                                                                            |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Pod Name Regular Expression       | Specifies the container whose logs are to be collected based on the pod name. Regular expression matching is supported.                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS will collect logs of the pods with names matching this expression. To collect logs of all pods, leave this field empty.                                                                                                                                                                                                                                                                                                                                        |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Name Regular Expression | Specifies the container whose logs are to be collected based on the container name (the Kubernetes container name is defined in **spec.containers**). Regular expression matching is supported.                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS will collect logs of the containers with names matching this expression. To collect logs of all containers, leave this field empty.                                                                                                                                                                                                                                                                                                                            |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Label Whitelist                   | Specifies the containers whose logs are to be collected. If you want to set a Kubernetes label whitelist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple whitelists, you can select the **And** or **Or** relationship. This means a container will be matched when it satisfies all or any of the whitelists.                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Label Value** is empty, LTS will match all containers whose Kubernetes label contains a specified **Label Key**. If **Label Value** is not empty, only containers whose Kubernetes label contains a specified **Label Key** that is equal to its **Label Value** are matched. **Label Key** requires full matching while **Label Value** supports regular matching.                                                                                           |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Label Blacklist                   | Specifies the containers whose logs are not to be collected. If you want to set a Kubernetes label blacklist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple blacklists, you can select the **And** or **Or** relationship. This means a container will be excluded when it satisfies all or any of the blacklists.                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Label Value** is empty, LTS will exclude all containers whose Kubernetes label contains a specified **Label Key**. If **Label Value** is not empty, only containers whose Kubernetes label contains a specified **Label Key** that is equal to its **Label Value** will be excluded. **Label Key** requires full matching while **Label Value** supports regular matching.                                                                                    |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Kubernetes Label                  | After the **Kubernetes Label** is set, LTS adds related fields to logs.                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS adds the specified fields to the log when each **Label Key** has a corresponding **Label Value**. For example, if you enter **app** as the key and **app_alias** as the value, when the container label contains **app=lts**, **{app_alias: lts}** will be added to the log.                                                                                                                                                                                   |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Label Whitelist         | Specifies the containers whose logs are to be collected. If you want to set a container label whitelist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple whitelists, you can select the **And** or **Or** relationship. This means a container will be matched when it satisfies all or any of the whitelists.                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Label Value** is empty, LTS will match all containers whose container label contains a specified **Label Key**. If **Label Value** is not empty, only containers whose container label contains a specified **Label Key** that is equal to its **Label Value** are matched. **Label Key** requires full matching while **Label Value** supports regular matching.                                                                                             |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Label Blacklist         | Specifies the containers whose logs are not to be collected. If you want to set a container label blacklist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple blacklists, you can select the **And** or **Or** relationship. This means a container will be excluded when it satisfies all or any of the blacklists.                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Label Value** is empty, LTS will exclude all containers whose container label contains a specified **Label Key**. If **Label Value** is not empty, only containers whose container label contains a specified **Label Key** that is equal to its **Label Value** will be excluded. **Label Key** requires full matching while **Label Value** supports regular matching.                                                                                      |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Container Label                   | After the **Container Label** is set, LTS adds related fields to logs.                                                                                                                                                                                                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS adds the specified fields to the log when each **Label Key** has a corresponding **Label Value**. For example, if you enter **app** as the key and **app_alias** as the value, when the container label contains **app=lts**, **{app_alias: lts}** will be added to the log.                                                                                                                                                                                   |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Environment Variable Whitelist    | Specifies the containers whose logs are to be collected. If you want to set an environment variable whitelist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple whitelists, you can select the **And** or **Or** relationship. This means a container will be matched when it satisfies all or any of the whitelists.                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Environment Variable Value** is empty, LTS will match all containers whose environment variable contains a specified **Environment Variable Key**. If **Environment Variable Value** is not empty, only containers whose environment variable contains a specified **Environment Variable Key** that is equal to its **Environment Variable Value** are matched. **Label Key** requires full matching while **Label Value** supports regular matching.        |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Environment Variable Blacklist    | Specifies the containers whose logs are not to be collected. If you want to set an environment variable blacklist, **Label Key** is mandatory and **Label Value** is optional.                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | When adding multiple blacklists, you can select the **And** or **Or** relationship. This means a container will be excluded when it satisfies all or any of the blacklists.                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If **Environment Variable Value** is empty, LTS will exclude all containers whose environment variable contains a specified **Environment Variable Key**. If **Environment Variable Value** is not empty, only containers whose environment variable contains a specified **Environment Variable Key** that is equal to its **Environment Variable Value** will be excluded. **Label Key** requires full matching while **Label Value** supports regular matching. |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Environment Variable Label        | After the environment variable label is set, the log service adds related fields to the log.                                                                                                                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | LTS adds the specified fields to the log when each **Environment Variable Key** has a corresponding **Environment Variable Value**. For example, if you enter **app** as the key and **app_alias** as the value, when the Kubernetes environment variable contains **app=lts**, **{app_alias: lts}** will be added to the log.                                                                                                                                     |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Set other configurations.

   .. table:: **Table 3** Other configurations

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                        |
      +===================================+====================================================================================================================================================================================================================================================================================================================================================================+
      | Split Logs                        | -  If log splitting is enabled, logs exceeding the specified size will be split into multiple logs for collection. Specify the size in the range from 500 KB to 1,024 KB. For example, if you set the size to 500 KB, a 600 KB log will be split into a 500 KB log and a 100 KB log. This restriction is applicable to single-line logs only, not multi-line logs. |
      |                                   | -  If log splitting is disabled, when a log exceeds 500 KB, the extra part will be truncated and discarded.                                                                                                                                                                                                                                                        |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Collect Binary Files              | LTS can collect binary files.                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | Run the **file -i** *File_name* command to view the file type. **charset=binary** indicates that a log file is a binary file.                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If this option is enabled, binary log files will be collected, but only UTF-8 strings are supported. Other strings will be garbled on the LTS console.                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | If this option is disabled, binary log files will not be collected.                                                                                                                                                                                                                                                                                                |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Custom Metadata                   | -  If this option is disabled, ICAgent will report logs to LTS based on the default system fields. You do not need to and cannot configure the fields.                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   | -  If this option is enabled, ICAgent will report logs based on your selected built-in fields and fields created with custom key-value pairs.                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |    **Built-in Fields**: Select built-in fields as required.                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |    **Custom Key-Value Pairs**: Click **Add** and set a key and value.                                                                                                                                                                                                                                                                                              |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Configure the log format and time by referring to :ref:`Table 4 <lts_04_0511__en-us_topic_0000001327056857_table18406251941>`.

   .. _lts_04_0511__en-us_topic_0000001327056857_table18406251941:

   .. table:: **Table 4** Log collection settings

      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                         |
      +===================================+=====================================================================================================================================================================================================================================================================================================================================================+
      | Log Format                        | -  **Single-line**: Each log line is displayed as a single log event.                                                                                                                                                                                                                                                                               |
      |                                   | -  **Multi-line**: Multiple lines of exception log events can be displayed as a single log event. This is helpful when you check logs to locate problems.                                                                                                                                                                                           |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Log Time                          | **System time**: log collection time by default. It is displayed at the beginning of each log event.                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  Log collection time is the time when logs are collected and sent by ICAgent to LTS.                                                                                                                                                                                                                                                              |
      |                                   | -  Log printing time is the time when logs are printed. ICAgent collects and sends logs to LTS with an interval of 1 second.                                                                                                                                                                                                                        |
      |                                   | -  Restriction on log collection time: Logs are collected within 24 hours before and after the system time.                                                                                                                                                                                                                                         |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                                   | **Time wildcard**: You can set a time wildcard so that ICAgent will look for the log printing time as the beginning of a log event.                                                                                                                                                                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  If the time format in a log event is **2019-01-01 23:59:59.011**, the time wildcard should be set to **YYYY-MM-DD hh:mm:ss.SSS**.                                                                                                                                                                                                                |
      |                                   | -  If the time format in a log event is **19-1-1 23:59:59.011**, the time wildcard should be set to **YY-M-D hh:mm:ss.SSS**. If a log event does not contain year information, ICAgent regards it as printed in the current year.                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | Example:                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | .. code-block::                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    YY   - year (19)                                                                                                                                                                                                                                                                                                                                 |
      |                                   |    YYYY - year (2019)                                                                                                                                                                                                                                                                                                                               |
      |                                   |    M    - month (1)                                                                                                                                                                                                                                                                                                                                 |
      |                                   |    MM   - month (01)                                                                                                                                                                                                                                                                                                                                |
      |                                   |    D    - day (1)                                                                                                                                                                                                                                                                                                                                   |
      |                                   |    DD   - day (01)                                                                                                                                                                                                                                                                                                                                  |
      |                                   |    hh   - hours (23)                                                                                                                                                                                                                                                                                                                                |
      |                                   |    mm   - minutes (59)                                                                                                                                                                                                                                                                                                                              |
      |                                   |    ss   - seconds (59)                                                                                                                                                                                                                                                                                                                              |
      |                                   |    SSS - millisecond (999)                                                                                                                                                                                                                                                                                                                          |
      |                                   |    hpm     - hours (03PM)                                                                                                                                                                                                                                                                                                                           |
      |                                   |    h:mmpm    - hours:minutes (03:04PM)                                                                                                                                                                                                                                                                                                              |
      |                                   |    h:mm:sspm  - hours:minutes:seconds (03:04:05PM)                                                                                                                                                                                                                                                                                                  |
      |                                   |    hh:mm:ss ZZZZ (16:05:06 +0100)                                                                                                                                                                                                                                                                                                                   |
      |                                   |    hh:mm:ss ZZZ  (16:05:06 CET)                                                                                                                                                                                                                                                                                                                     |
      |                                   |    hh:mm:ss ZZ   (16:05:06 +01:00)                                                                                                                                                                                                                                                                                                                  |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Log Segmentation                  | This parameter needs to be specified if the **Log Format** is set to **Multi-line**. **By generation time** indicates that a time wildcard is used to detect log boundaries, whereas **By regular expression** indicates that a regular expression is used.                                                                                         |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | By regular expression             | You can set a regular expression to look for a specific pattern to indicate the beginning of a log event. This parameter needs to be specified when you select **Multi-line** for **Log Format** and **By regular expression** for **Log Segmentation**.                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | The time wildcard and regular expression will look for the specified pattern right from the beginning of each log line. If no match is found, the system time, which may be different from the time in the log event, is used. In general cases, you are advised to select **Single-line** for **Log Format** and **System time** for **Log Time**. |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _lts_04_0511__en-us_topic_0000001327056857_section1378734643812:

Step: Configure Log Structuring
-------------------------------

#. Configure log structuring. For details, see :ref:`Setting Cloud Structuring Parsing <lts_0821>`.
#. Click **Next: Index Settings**.

.. _lts_04_0511__en-us_topic_0000001327056857_section164619915326:

Step 5: Configure Indexing
--------------------------

#. Configure indexing. For details, see :ref:`Setting Indexes <lts_05_0008>`.
#. Click **Submit**.

.. _lts_04_0511__en-us_topic_0000001327056857_section2042505817322:

Step 6: Complete the Ingestion Configuration
--------------------------------------------

The created ingestion configuration will be displayed.

-  Click its name to view its details.

-  Click **Modify** in the **Operation** column to modify the ingestion configuration.

-  Click **Configure Tag** in the **Operation** column to add a tag.

-  Click **More** > **Copy** in the **Operation** column to copy the ingestion configuration.

-  Click **More** > **Delete** in the **Operation** column to delete the ingestion configuration.

   Deleting an ingestion configuration may lead to log collection failures, potentially resulting in service exceptions related to user logs. In addition, the deleted ingestion configuration cannot be restored. Exercise caution when performing this operation.

.. _lts_04_0511__en-us_topic_0000001327056857_section124378505151:

Setting Multiple Ingestion Configurations in a Batch
----------------------------------------------------

You can set multiple ingestion configurations for multiple scenarios in a batch, avoiding repetitive setups.

#. On the **Ingestion Management** page, click **Batch Ingest** to go to the details page. For details, see :ref:`Table 5 <lts_04_0511__en-us_topic_0000001327056857_table960663620>`.

   .. _lts_04_0511__en-us_topic_0000001327056857_table960663620:

   .. table:: **Table 5** Adding configurations in batches

      +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Type                  | Parameter             | Description                                                                                                                                                                                         |
      +=======================+=======================+=====================================================================================================================================================================================================+
      | Basic Settings        | Ingestion Type        | Select **CCE (Cloud Container Engine)**.                                                                                                                                                            |
      +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Configurations to Add | Enter the number of ingestion configurations in the text box and click **Add**.                                                                                                                     |
      |                       |                       |                                                                                                                                                                                                     |
      |                       |                       | A maximum of 100 ingestion configurations can be added, including the one already exists under **Ingestion Settings** by default. Therefore, you can add up to 99 more.                             |
      +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Ingestion Settings    | Configuration List    | a. The ingestion configurations are displayed on the left. You can add up to 99 more configurations.                                                                                                |
      |                       |                       | b. The ingestion configuration items are displayed on the right. Set them by referring to :ref:`Step 4: Configure the Collection <lts_04_0511__en-us_topic_0000001327056857_section1191613128141>`. |
      |                       |                       | c. After an ingestion configuration is complete, you can click **Apply to Other Configurations** to copy its settings to other configurations.                                                      |
      +-----------------------+-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Click **Check Parameters**. After the check is successful, click **Submit**.

   The added ingestion configurations will be displayed on the **Ingestion Management** page after the batch creation is successful.

#. (Optional) Perform the following operations on ingestion configurations:

   -  Select multiple existing ingestion configurations and click **Edit**. On the displayed page, select an ingestion type to modify the corresponding ingestion configurations.
   -  Select multiple existing ingestion configurations and click **Enable** or **Disable**. Logs will not be collected for disabled ingestion configurations.
   -  Select multiple existing ingestion configurations and click **Delete**.
